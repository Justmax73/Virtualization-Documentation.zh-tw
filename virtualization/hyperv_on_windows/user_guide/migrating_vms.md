---
redirect_url: http://aka.ms/upgradevmconfig
---

# 移轉和升級虛擬機器

如果您將虛擬機器移至 Windows 10 主機時 (您原先在 Windows 8.1 或更早版本以 Hyper-V 建立的 Windows 10)，您將無法使用新的虛擬機器功能，直到您手動更新虛擬機器設定版本。

若要升級設定版本，請將虛擬機器關機，然後在 Hyper-V 管理員中選取要升級虛擬機器設定。 您也可以開啟提升權限的 Windows PowerShell 命令提示字元，並輸入：

 ```PowerShell
Update-VmVersion <vmname> | <vmobject>
 ```

## 如何檢查在 Hyper-V 上執行的虛擬機器的設定版本？

若要找出設定版本，開啟提升權限的 Windows PowerShell 命令提示字元，並執行下列命令：

**Get-VM * | Format-Table Name, Version**

此 Powershell 命令會產生下列範例輸出：

```
Name        State       CPUUsage(%) MemoryAssigned(M)   Uptime              Status                  Version

Atlantis    Running         0       1024                00:04:20.5910000    Operating normally      5.0

SGC VM      Running         0       538                 00:02:44.8350000    Operating normally      6.2
```


## 如果我沒有升級設定版本會發生什麼事？

如果您有使用較早版本的 Hyper-V 建立的虛擬機器，某些功能可能不適用於這些虛擬機器，除非您更新 VM 的版本。

新 Hyper-V 功能的 VM 設定版本最低需求：

| **功能名稱**| **VM 版本最低需求**| |
| :------------------------------------- | -----------------: ||
| 熱新增/移除記憶體| 6.0| |
| 熱新增/移除網路介面卡| 5.0| |
| Linux VM 的安全開機| 6.0| |
| 生產檢查點| 6.0| |
| PowerShell Direct| 6.2| |
| 虛擬信賴平台模組 (vTPM)| 6.2| |
| 虛擬機器群組| 6.2| |



## 虛擬機器設定版本

當您將虛擬機器從執行 Windows 8.1 的主機移動或匯入至執行 Hyper-V 的 Windows 10 主機時，虛擬機器的設定檔案不會自動升級。 這讓虛擬機器可以移回執行 Windows 8.1 的主機。 您將不能存取新的虛擬機器功能，直到您手動更新虛擬機器設定版本。

虛擬機器設定版本代表虛擬機器設定的 Hyper-V 版本、儲存的狀態，以及與之相容的快照檔案。 設定版本 5 的虛擬機器與 Windows 8.1 相容，可以在 Windows 8.1 和 Windows 10 上執行。 設定版本 6 的虛擬機器與 Windows 10 相容，無法在 Windows 8.1 上執行。

您不一定要同時升級所有的虛擬機器。 您可以選擇在必要時升級特定虛擬機器。 不過，您將不能存取新的虛擬機器功能，直到您手動更新每個虛擬機器的設定版本。


----------------

**重要**

• 升級虛擬機器設定版本之後，無法將虛擬機器移至執行 Windows 8.1 的主機。

• 您無法將虛擬機器設定版本從版本 6 降級至版本 5。

• 您必須關閉虛擬機器，才能升級虛擬機器設定。

• 升級之後，虛擬機器會使用新的設定檔案格式。 如需詳細資訊，請參閱新的虛擬機器設定檔案格式。

--------






## 升級虛擬機器的版本時，會發生什麼事？

當您手動將虛擬機器的設定版本升級至版本 6.x，您要變更用來儲存虛擬機器設定和檢查點檔案的檔案結構。

升級後的虛擬機器會使用新的設定檔案格式，這種格式是為了提高讀取和寫入虛擬機器設定資料的效率而設計。 升級也會減少儲存體失敗時的資料損毀可能性。

下表列出升級後虛擬機器的二進位檔案位置和副檔名資訊。

| **虛擬機器設定和檢查點檔案 (版本 6.x)**| **描述**| |
|:---------------|:----------------||
| **虛擬機器設定**| 設定資訊會儲存在副檔名為 .vmcx 的二進位檔案格式中。| |
| **虛擬機器執行階段狀態**| 執行階段資料會儲存在副檔名為 .vmrs 的二進位檔案格式中。| |
| **虛擬機器虛擬硬碟**| 虛擬機器的虛擬硬碟檔案。副檔名為 .vhd 或 .vhdx 。| |
| **自動虛擬硬碟檔案**| 用於虛擬機器檢查點的差異磁碟檔案。副檔名為 .avhdx。| |
| **檢查點檔案**| 檢查點會儲存在多個檢查點檔案中。每個檢查點會建立設定檔案和執行階段狀態檔案。檢查點檔案的副檔名為 .vmrs 和 .vmcx。這些新的檔案格式也用於生產檢查點和標準檢查點。| |

將虛擬機器設定版本升級至版本 6.x 之後，不可能再從版本 6.x 降級到版本 5。

必須關閉虛擬機器才能升級虛擬機器設定。

下表列出新的或升級後的虛擬機器的預設檔案位置。

| **虛擬機器檔案 (版本 6.x)**| **描述**| |
|:-----|:-----||
| **虛擬機器設定檔案**| C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual Machines| |
| **虛擬機器執行階段狀態檔案**| C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual Machines| |
| **檢查點檔案 (.vmrs, .vmcx)**| C:\ProgramData\Microsoft\Windows\Snapshots| |
| **虛擬硬碟檔案 (.vhd/.vhdx)**| C:\Users\Public\Documents\Hyper-V\Virtual Hard Disks| |
| **自動虛擬硬碟檔案 (.avhdx)**| C:\Users\Public\Documents\Hyper-V\Virtual Hard Disks| |










<!--HONumber=May16_HO1-->


